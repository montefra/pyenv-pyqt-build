#!/bin/bash
# Summary: Install sip for the current active python version
#
# Usage: pyenv sip
# 
# Use pip install sip. If it fails (e.g. wrong python) install it from source

[ -n "$PYENV_DEBUG" ] && set -x

# Provide pyenv completions
if [ "$1" = "--complete" ]; then
  echo system
  # completion for versions: disabled for now
  # exec pyenv-versions --bare
fi

version=`pyenv-version-name`

if [ "$version" = "system" ]
then
    >&2 echo "I am not allowed to install sip system-wide."
    >&2 echo "Please select a shell or an environment first."
    exit 1
fi

sip_version='4.19.1'

echo "Try to install SIP with pip"

pyenv-exec pip install sip 2>/dev/null

if [ $? -eq 0 ]
then
    echo "SIP has been successfully installed"
else
    echo "SIP cannot be installed using pip."
    echo "Falling back to installation from source"
    echo "Fetch version $sip_version"
fi
